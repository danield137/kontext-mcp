# Kontext MCP Server

Kontext is a thin Python MCP server that provides portable, provider-agnostic memory on top of Azure Data Explorer (Kusto). It exposes two core tools—`remember` and `recall`—to bridge the gap between simple vector stores and a true "context engine."

## Features

- **remember**: Store facts with automatic embedding generation using Kusto's `ai_embeddings()` plugin
- **recall**: Retrieve semantically similar facts using cosine similarity search
- **FastMCP Integration**: Built on the FastMCP framework for easy tool registration and schema generation
- **Kusto Backend**: Leverages Azure Data Explorer for scalable storage and querying
- **Minimal Design**: Start simple with embeddings + cosine similarity (advanced scoring features to be added later)

## Architecture

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   MCP Client    │───▶│  Kontext MCP    │───▶│ Azure Data      │
│   (Agent)       │    │    Server       │    │   Explorer      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │ ai_embeddings() │
                       │    Plugin       │
                       └─────────────────┘
```

## Installation

1. Clone the repository:
```bash
git clone https://github.com/danield137/kontext-mcp.git
cd kontext-mcp
```

2. Install dependencies:
```bash
pip install -r requirements.txt
```

3. Set environment variables:
```bash
export KUSTO_CLUSTER="https://your-cluster.kusto.windows.net"
export KUSTO_DATABASE="your-database"
export KUSTO_TABLE="Memory"  # Optional, defaults to "Memory"
export EMBED_MODEL="text-embedding-ada-002"  # Optional
```

## Usage

### Running the Server

```bash
# As a module
python -m kontext_mcp

# Or directly
python kontext_mcp/server.py
```

### MCP Tools

#### remember
Stores a fact in the Kusto-backed memory table.

**Parameters:**
- `fact` (string): Text to remember
- `meta` (object, optional): Arbitrary metadata

**Returns:**
- `id` (string): UUID of the stored fact

**Example:**
```json
{
  "fact": "The user prefers morning meetings",
  "meta": {
    "source": "calendar",
    "importance": 0.8,
    "tags": ["scheduling", "preferences"]
  }
}
```

#### recall
Retrieves semantically similar facts using cosine similarity.

**Parameters:**
- `query` (string): Search query
- `meta` (object, optional): Metadata filters
- `top_k` (integer, optional): Maximum results (default: 20)

**Returns:**
Array of objects with:
- `id` (string): Fact identifier
- `fact` (string): The stored text
- `meta` (object): Associated metadata
- `score` (number): Similarity score (0-1)

**Example:**
```json
{
  "query": "meeting preferences",
  "meta": {
    "source": "calendar"
  },
  "top_k": 5
}
```

## Database Schema

The Memory table uses the following schema:

```kusto
Memory
| id: string          // Unique identifier
| fact: string        // The text content
| meta: dynamic       // JSON metadata
| embedding: dynamic  // Vector embedding (generated by ai_embeddings)
| ingest_time: datetime // When the fact was stored
| usage_count: int    // Access counter (for future use)
```

## Development

### Running Tests

```bash
pytest tests/
```

### Project Structure

```
kontext_mcp/
├── __init__.py          # Package initialization
├── config.py            # Configuration management
├── logging_util.py      # Logging utilities
├── kusto_client.py      # Kusto client wrapper
├── tools.py             # MCP tool implementations
├── register.py          # Tool registration
├── server.py            # Main server module
└── __main__.py          # Module entry point

tests/
├── test_remember.py     # Tests for remember tool
└── test_recall.py       # Tests for recall tool
```

## Configuration

Kontext uses environment variables for configuration:

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `KUSTO_CLUSTER` | Yes | - | Kusto cluster URI |
| `KUSTO_DATABASE` | Yes | - | Database name |
| `KUSTO_TABLE` | No | "Memory" | Table name for storing facts |
| `EMBED_MODEL` | No | "text-embedding-ada-002" | Embedding model identifier |

## Roadmap

- [ ] Advanced scoring (recency, frequency, decay)
- [ ] Batch operations
- [ ] Fact update/deletion
- [ ] Custom similarity thresholds
- [ ] Performance monitoring
- [ ] Multi-tenant support

## License

MIT License - see LICENSE file for details.

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.
